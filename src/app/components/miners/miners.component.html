<div class="miners-container">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1>Gestión de Mineros</h1>
        <p *ngIf="authService.isMinero()">Tu información personal y sensores</p>
        <p *ngIf="!authService.isMinero()">Administra y monitorea todos los mineros</p>
      </div>
      <div class="header-right" *ngIf="canCreateMiner()">
        <button class="btn btn-primary" (click)="openCreateModal()">
          <i class="fas fa-plus"></i>
          Nuevo Minero
        </button>
      </div>
    </div>
  </header>

  <!-- Stats Cards -->
  <section class="stats-section" *ngIf="!authService.isMinero()">
    <div class="stats-grid">
      <div class="stat-card glass">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>{{ totalMiners }}</h3>
          <p>Total Mineros</p>
        </div>
      </div>
      
      <div class="stat-card glass">
        <div class="stat-icon active">
          <i class="fas fa-wifi"></i>
        </div>
        <div class="stat-content">
          <h3>{{ activeMiners }}</h3>
          <p>Activos</p>
        </div>
      </div>
      
      <div class="stat-card glass">
        <div class="stat-icon warning">
          <i class="fas fa-user-slash"></i>
        </div>
        <div class="stat-content">
          <h3>{{ inactiveMiners }}</h3>
          <p>Inactivos</p>
        </div>
      </div>
      
      <div class="stat-card glass">
        <div class="stat-icon">
          <i class="fas fa-birthday-cake"></i>
        </div>
        <div class="stat-content">
          <h3>{{ avgAge | number:'1.0-0' }}</h3>
          <p>Edad Promedio</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Filters Section -->
  <section class="filters-section" *ngIf="!authService.isMinero()">
    <div class="filters-container">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          placeholder="Buscar por nombre, correo o RFC..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
        >
      </div>
      
      <div class="filter-options">
        <select [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
          <option *ngFor="let option of getStatusOptions()" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        
        <button class="btn btn-secondary">
          <i class="fas fa-filter"></i>
          Filtros Avanzados
        </button>
      </div>
    </div>
  </section>

  <!-- Miners Grid -->
  <section class="miners-section">
    <div class="section-header" *ngIf="!authService.isMinero()">
      <h2>Lista de Mineros</h2>
      <span class="results-count">{{ filteredMiners.length }} mineros encontrados</span>
    </div>
  
    <div class="miners-grid">
      <div class="miner-card glass" *ngFor="let miner of filteredMiners; let i = index">
        <div class="card-header">
          <div class="miner-info">
            <div class="miner-avatar">
              <span>{{ miner.photo || miner.fullName.charAt(0) }}</span>
            </div>
            <div class="miner-details">
              <h3>{{ miner.fullName }}</h3>
              <span class="miner-email">{{ miner.email }}</span>
              <span class="miner-rfc">{{ miner.rfc || 'RFC no especificado' }}</span>
            </div>
          </div>
          <div class="status-badge" [style.background-color]="getStatusColor(miner.status)">
            {{ getStatusText(miner.status) }}
          </div>
        </div>
        
        <div class="card-body">
          <div class="miner-details-grid">
            <div class="detail-item">
              <span class="detail-label">Teléfono:</span>
              <span class="detail-value">{{ miner.phone || 'No especificado' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Fecha Nacimiento:</span>
              <span class="detail-value">{{ miner.birthDate ? (miner.birthDate | date:'dd/MM/yyyy') : 'No especificada' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Equipo:</span>
              <span class="detail-value">
                {{ miner.teamId ? 'Equipo ' + miner.teamId : 'Sin equipo asignado' }}
              </span>
            </div>
          </div>
          
          <div class="address-section">
            <h4>Dirección</h4>
            <p>{{ getFullAddress(miner) }}</p>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="btn btn-primary" (click)="showDetail(miner)">
            <i class="fas fa-eye"></i>
            Ver Detalle
          </button>
          
          <button 
            class="btn btn-secondary" 
            *ngIf="canModifyMiner()"
            (click)="editMiner(miner)"
          >
            <i class="fas fa-edit"></i>
            Editar
          </button>
          
          <button 
            class="btn btn-danger" 
            *ngIf="canModifyMiner()"
            (click)="deleteMiner(miner)"
          >
            <i class="fas fa-trash"></i>
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Create Miner Modal -->
  <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
    <div class="modal-content glass" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Registrar Nuevo Minero</h3>
        <button class="close-btn" (click)="closeCreateModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <form (ngSubmit)="createMiner()">
          <div class="form-row">
            <div class="form-group">
              <label for="fullName">Nombre Completo</label>
              <input 
                type="text" 
                id="fullName"
                [(ngModel)]="newMiner.fullName" 
                name="fullName"
                placeholder="Nombre completo del minero"
                required
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="email">Correo Electrónico</label>
            <input 
              type="email" 
              id="email"
              [(ngModel)]="newMiner.email" 
              name="email"
              placeholder="correo@ejemplo.com"
              required
            >
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="birthDate">Fecha de Nacimiento</label>
              <input 
                type="date" 
                id="birthDate"
                [(ngModel)]="newMiner.birthDate" 
                name="birthDate"
                required
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="phone">Teléfono</label>
            <input 
              type="tel" 
              id="phone"
              [(ngModel)]="newMiner.phone" 
              name="phone"
              placeholder="+52 55 1234 5678"
            >
          </div>
          
          <div class="form-group">
            <label for="rfc">RFC</label>
            <input 
              type="text" 
              id="rfc"
              [(ngModel)]="newMiner.rfc" 
              name="rfc"
              placeholder="RFC del minero"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="address">Dirección</label>
            <textarea 
              id="address"
              [(ngModel)]="newMiner.address" 
              name="address"
              placeholder="Dirección completa del minero"
              rows="3"
            ></textarea>
          </div>
          
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Registrar Minero
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Miner Modal -->
  <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal-content glass" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Editar Minero</h3>
        <button class="close-btn" (click)="closeEditModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveEditMiner()">
          <div class="form-row">
            <div class="form-group">
              <label for="editFullName">Nombre Completo</label>
              <input type="text" id="editFullName" [(ngModel)]="editMinerData.fullName" name="editFullName" required>
            </div>
          </div>
          <div class="form-group">
            <label for="editEmail">Correo Electrónico</label>
            <input type="email" id="editEmail" [(ngModel)]="editMinerData.email" name="editEmail" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="editBirthDate">Fecha de Nacimiento</label>
              <input type="date" id="editBirthDate" [(ngModel)]="editMinerData.birthDate" name="editBirthDate">
            </div>
          </div>
          <div class="form-group">
            <label for="editPhone">Teléfono</label>
            <input type="tel" id="editPhone" [(ngModel)]="editMinerData.phone" name="editPhone">
          </div>
          <div class="form-group">
            <label for="editRfc">RFC</label>
            <input type="text" id="editRfc" [(ngModel)]="editMinerData.rfc" name="editRfc">
          </div>
          <div class="form-group">
            <label for="editAddress">Dirección</label>
            <textarea id="editAddress" [(ngModel)]="editMinerData.address" name="editAddress" rows="3"></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancelar</button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Guardar Cambios
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Detail Miner Modal -->
  <div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
    <div class="modal-content glass" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Detalle del Minero</h3>
        <button class="close-btn" (click)="closeDetailModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="detail-row"><strong>Nombre:</strong> {{ detailMinerData.fullName }}</div>
        <div class="detail-row"><strong>Email:</strong> {{ detailMinerData.email }}</div>
        <div class="detail-row"><strong>RFC:</strong> {{ detailMinerData.rfc }}</div>
        <div class="detail-row"><strong>Teléfono:</strong> {{ detailMinerData.phone }}</div>
        <div class="detail-row"><strong>Dirección:</strong> {{ detailMinerData.address }}</div>
        <div class="detail-row"><strong>Fecha de Nacimiento:</strong> {{ detailMinerData.birthDate | date:'dd/MM/yyyy' }}</div>
        <div class="detail-row"><strong>Estado:</strong> {{ detailMinerData.status }}</div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeDetailModal()">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div> 