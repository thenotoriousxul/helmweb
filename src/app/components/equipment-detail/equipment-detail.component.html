<div class="equipment-detail-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <button class="back-button" (click)="backToEquipments()">
        <i class="fas fa-arrow-left"></i>
        Volver a Equipos
      </button>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="editEquipment()">
          <i class="fas fa-edit"></i>
          Editar
        </button>
        <button class="btn btn-danger" (click)="deleteEquipment()">
          <i class="fas fa-trash"></i>
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <!-- Equipment Info -->
  <div class="equipment-info" *ngIf="equipment">
    <div class="equipment-header">
      <div class="equipment-title">
        <h1>{{ equipment.nombre }}</h1>
      </div>
      <div class="equipment-stats">
        <div class="stat">
          <span class="stat-value">{{ equipment.mineros.length || 0 }}</span>
          <span class="stat-label">Mineros</span>
        </div>
      </div>
    </div>

    <div class="equipment-details">
      <div class="detail-row">
        <div class="detail-item">
          <span class="detail-label">Zona:</span>
          <span class="detail-value">{{ equipment.zona }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Supervisor:</span>
          <span class="detail-value">{{ getSupervisorName(equipment.supervisor) }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Fecha de creación:</span>
          <span class="detail-value">{{ equipment.createdAt | date:'short' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs-container">
    <div class="tabs">
      <button class="tab" [class.active]="activeTab === 'summary'" (click)="activeTab = 'summary'">
        <i class="fas fa-chart-pie"></i>
        Resumen
      </button>
      <button class="tab" [class.active]="activeTab === 'miners'" (click)="activeTab = 'miners'">
        <i class="fas fa-users"></i>
        Mineros
      </button>
      <button class="tab" [class.active]="activeTab === 'helmets'" (click)="activeTab = 'helmets'">
        <i class="fas fa-hard-hat"></i>
        Cascos
      </button>
      <button class="tab" [class.active]="activeTab === 'alerts'" (click)="activeTab = 'alerts'">
        <i class="fas fa-exclamation-triangle"></i>
        Alertas
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Summary Tab -->
      <div class="tab-pane" *ngIf="activeTab === 'summary'">
        <div class="summary-grid">
          <div class="summary-card">
            <h3>Estado General</h3>
            <div class="summary-stats">
              <div class="summary-stat">
                <span class="stat-number">{{ equipment?.mineros?.length || 0 }}</span>
                <span class="stat-text">Mineros Asignados</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Miners Tab -->
      <div class="tab-pane" *ngIf="activeTab === 'miners'">
        <h3>Mineros asignados ({{ equipment?.mineros?.length || 0 }})</h3>
        <form (ngSubmit)="addMiner()" #minerForm="ngForm" class="form-minero">
          <div class="form-row">
            <input type="text" [(ngModel)]="newMiner.fullName" name="fullName" placeholder="Nombre completo" required />
            <input type="email" [(ngModel)]="newMiner.email" name="email" placeholder="Correo electrónico" required />
          </div>
          <div class="form-row">
            <input type="date" [(ngModel)]="newMiner.fechaContratacion" name="fechaContratacion" placeholder="Fecha de contratación" />
            <input type="text" [(ngModel)]="newMiner.especialidadEnMineria" name="especialidadEnMineria" placeholder="Especialidad en minería" />
            <select [(ngModel)]="newMiner.genero" name="genero">
              <option value="">Género</option>
              <option value="masculino">Masculino</option>
              <option value="femenino">Femenino</option>
            </select>
          </div>
          <button type="submit" class="btn btn-secondary" [disabled]="minerForm.invalid">Registrar Minero</button>
        </form>
        <div *ngIf="equipment?.mineros?.length; else sinMineros">
          <div class="minero-card" *ngFor="let tm of equipment.mineros">
            <div class="minero-info">
              <span class="minero-nombre">{{ tm.minero?.fullName || 'Sin nombre' }}</span>
              <span class="minero-email" *ngIf="tm.minero?.email">({{ tm.minero?.email }})</span>
              <span class="minero-estado" [ngClass]="{'activo': tm.activo, 'inactivo': !tm.activo}">
                {{ tm.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </div>
            <div class="minero-extra">
              <span *ngIf="tm.minero?.especialidadEnMineria">Especialidad: {{ tm.minero?.especialidadEnMineria }}</span>
              <span *ngIf="tm.minero?.birthDate"><br>Fecha de nacimiento: {{ tm.minero?.birthDate }}</span>
              <span *ngIf="tm.minero?.phone"><br>Teléfono: {{ tm.minero?.phone }}</span>
              <span *ngIf="tm.minero?.address"><br>Dirección: {{ tm.minero?.address }}</span>
              <span *ngIf="tm.minero?.rfc"><br>RFC: {{ tm.minero?.rfc }}</span>
              <span *ngIf="tm.fechaAsignacion"><br>Asignado desde: {{ tm.fechaAsignacion | date:'short' }}</span>
            </div>
          </div>
        </div>
        <ng-template #sinMineros>
          <p class="sin-mineros">No hay mineros asignados a este equipo.</p>
        </ng-template>
      </div>

      <!-- Helmets Tab -->
      <div class="tab-pane" *ngIf="activeTab === 'helmets'">
        <div class="helmets-grid">
          <div class="helmet-card" *ngFor="let helmet of helmets">
            <div class="helmet-header">
              <h4>{{ helmet.id }}</h4>
              <span class="helmet-status" [style.background-color]="getStatusColor(helmet.status)">
                {{ getStatusText(helmet.status) }}
              </span>
            </div>
            <div class="helmet-info">
              <div class="helmet-detail">
                <span class="detail-label">Miner:</span>
                <span class="detail-value">{{ helmet.minerName }}</span>
              </div>
              <div class="helmet-detail">
                <span class="detail-label">Batería:</span>
                <span class="detail-value">{{ helmet.batteryLevel }}%</span>
              </div>
              <div class="helmet-detail">
                <span class="detail-label">Última señal:</span>
                <span class="detail-value">{{ helmet.lastSignal }}</span>
              </div>
              <div class="helmet-detail">
                <span class="detail-label">Alertas:</span>
                <span class="detail-value">{{ helmet.alerts }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Alerts Tab -->
      <div class="tab-pane" *ngIf="activeTab === 'alerts'">
        <div class="alerts-list">
          <div class="alert-item" *ngFor="let alert of alerts">
            <div class="alert-header">
              <span class="alert-type">{{ getAlertTypeText(alert.type) }}</span>
              <span class="alert-severity" [style.background-color]="getSeverityColor(alert.severity)">
                {{ alert.severity.toUpperCase() }}
              </span>
            </div>
            <div class="alert-content">
              <p class="alert-message">{{ alert.message }}</p>
              <div class="alert-meta">
                <span class="alert-miner">{{ alert.minerName }}</span>
                <span class="alert-time">{{ alert.timestamp }}</span>
                <span class="alert-status">{{ alert.status }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 